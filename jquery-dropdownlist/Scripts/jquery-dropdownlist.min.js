(function(n){function t(t,i){let r=this,u=!1;this.element=t;this.options=i;this.fieldName=this.options.getFieldName(this.element)||"dropdownlist-"+Math.random().toString().replace(".","");this.isMultiselect=this.options.isMultiselect(this.element);this.selectAllItem=this.isMultiselect?this.options.getSelectAllItem(this.element):n();this.textSearch=n();this.items=this.options.getItems(this.element);this.emptyText=this.options.getEmptyText();this.container=n("<div>",{"class":"dropdownlist"});this.element.before(this.container);this.selector=n("<div>",{"class":"dropdownlist-selector"});this.selectorText=n("<div>",{"class":"dropdownlist-selector-text"});this.selector.append(this.selectorText,n("<div>",{"class":"dropdownlist-selector-toggle"}));this.list=n("<div>",{"class":"dropdownlist-list"}).append(this.element).hide();this.options.hasTextSearch(this.element)&&(this.textSearch=n("<input>",{type:"text","class":"dropdownlist-search"}),this.isMultiselect?this.list.prepend(this.textSearch):(this.selector.prepend(this.textSearch),this.textSearch.hide()));this.items.each(function(){let t={};r.isMultiselect&&r.selectAllItem.is(this)||(t.name=r.fieldName,t.value=r.options.getItemValue(n(this)));r.isMultiselect?(t.type="checkbox",t.class="dropdownlist-field"):(t.type="radio",t.class="dropdownlist-field dropdownlist-field-hidden");r.options.isItemSelected(n(this))&&(r.isMultiselect||!u)&&(t.checked="true",u=!0);n(this).prepend(n("<input>",t))});this.isMultiselect||this.getSelectedItems().length!==0||this.setSelectedItems(":first");this.isMultiselect&&this.selectAllItem.length>0&&this.selectAllItem.find("input.dropdownlist-field").prop("checked",this.areAllItemsSelected());this.container.append(this.selector);this.container.append(this.list);this.setSelectorText();this.selector.click(this,this.selectorClick);this.list.click(this,this.listClick);this.textSearch.keyup(this,this.textSearchKeyup);n(document).click(this,this.documentClick)}n.fn.dropdownlist=function(i,r){return n.isFunction(i)&&(r=i,i=null),n(this).each(function(){let u;if(n(this).closest(".dropdownlist").length===0){let r=n.extend({},n.fn.dropdownlist.defaults,i);u=new t(n(this),r);n(this).data("dropdownlist",u)}else u=n(this).data("dropdownlist");n.isFunction(r)&&r.bind(u)(u)})};n.fn.dropdownlist.defaults={getItems:function(t){return n(t).children()},getSelectAllItem:function(t){return n(t).children().filter("[data-select-all]").first()},isItemSelected:function(t){return n(t).data("selected")!==undefined&&n(t).data("selected")!=!1},getFieldName:function(t){return n(t).data("field-name")},getItemValue:function(t){return n(t).data("value")||n(t).text()},getItemText:function(t){return n(t).text()},getEmptyText:function(){return"(Select...)"},isMultiselect:function(t){return n(t).data("multiselect")!==undefined&&n(t).data("multiselect")!=!1},hasTextSearch:function(t){return n(t).data("text-search")!==undefined&&n(t).data("text-search")!=!1},itemMatchesTextSearch:function(t,i){return n(t).text().toLocaleLowerCase().indexOf(i.toLocaleLowerCase())>-1}};t.prototype.selectorClick=function(t){n(t.target).is(t.data.textSearch)||t.data.toggle()};t.prototype.listClick=function(t){let i=n(t.target).closest(t.data.items);if(i.length!==0){let r=i.find("input.dropdownlist-field");r.is(t.target)?(t.data.isMultiselect&&t.data.selectAllItem.length>0&&(n(t.target).closest(t.data.selectAllItem).length>0?t.data.selectAllItem.find("input.dropdownlist-field").prop("checked")?t.data.selectAllItems():t.data.clearSelectedItems():t.data.selectAllItem.find("input.dropdownlist-field").prop("checked",t.data.areAllItemsSelected())),t.data.setSelectorText(),t.data.isMultiselect||t.data.toggle(),t.data.element.trigger("dropdownlist.selectedItemsChanged")):r.click()}};t.prototype.textSearchKeyup=function(n){var i=n.data.textSearch.val(),t=n.data.items;i&&(t=t.filter(function(){return n.data.options.itemMatchesTextSearch(this,i)}));n.data.items.not(t).hide();t.show()};t.prototype.documentClick=function(t){n(t.target).closest(t.data.container).length>0||t.data.hide()};t.prototype.toggle=function(){this.list.css("display")=="none"?this.show():this.hide()};t.prototype.hide=function(){this.list.hide();this.textSearch.length>0&&(this.isMultiselect?this.textSearch.val(""):(this.selectorText.show(),this.textSearch.hide(),this.textSearch.val(this.selectorText.text())),this.items.show())};t.prototype.show=function(){this.list.show();this.textSearch.length>0&&!this.isMultiselect&&(this.selectorText.hide(),this.textSearch.show().focus().select())};t.prototype.remove=function(){this.container.before(this.element);this.container.remove();this.items.find("input.dropdownlist-field").remove();this.selectAllItem.find("input.dropdownlist-field").remove();this.element.removeData("dropdownlist")};t.prototype.setSelectorText=function(){let i=this.getSelectedItems(),t=this.emptyText;i.length>0&&(t=n.map(i,this.options.getItemText).join(", "));this.selectorText.text(t);!this.isMultiselect&&this.textSearch.length>0&&this.textSearch.val(t)};t.prototype.getSelectedItems=function(){return this.items.has("input.dropdownlist-field:checked").not(this.selectAllItem)};t.prototype.getSelectedValues=function(){return n.map(this.getSelectedItems(),this.options.getItemValue)};t.prototype.setSelectedItems=function(n){let i=this.options.getItems(this.element),t=i.filter(n);this.options.isMultiselect(this.element)||(t=t.first(),t.length===0&&(t=i.first()));i.not(t).find("input.dropdownlist-field:checked").prop("checked",!1);t.find("input.dropdownlist-field:not(:checked)").prop("checked",!0);this.setSelectorText()};t.prototype.selectAllItems=function(){this.setSelectedItems("*")};t.prototype.clearSelectedItems=function(){this.setSelectedItems(!1)};t.prototype.areAllItemsSelected=function(){return this.items.has("input.dropdownlist-field:not(:checked)").not(this.selectAllItem).length===0}})(jQuery);