(function(n){function t(t,r){let u=this,f=!1;this.element=t;this.options=r;this.fieldName=this.options.getFieldName(this.element)||"dropdownlist-"+Math.random().toString().replace(".","");this.isMultiselect=this.options.isMultiselect(this.element);this.selectAllItem=this.isMultiselect?this.options.getSelectAllItem(this.element):n();this.allItems=this.options.getItems(this.element).add(this.selectAllItem);this.items=this.options.getItems(this.element).not(this.selectAllItem);this.textSearch=n();this.emptyText=this.options.getEmptyText();this.container=n("<div>",{"class":"dropdownlist"});this.element.before(this.container);this.selector=n("<div>",{"class":"dropdownlist-selector",tabindex:0});this.selectorText=n("<div>",{"class":"dropdownlist-selector-text"});this.selector.append(this.selectorText,n("<div>",{"class":"dropdownlist-selector-toggle"}));this.list=n("<div>",{"class":"dropdownlist-list"}).append(this.element).hide();this.options.hasTextSearch(this.element)&&(this.textSearch=n("<input>",{type:"text","class":"dropdownlist-search"}),this.isMultiselect?this.list.prepend(this.textSearch):(this.selector.prepend(this.textSearch),this.textSearch.hide()));this.items.each(function(){let t={name:u.fieldName,value:u.options.getItemValue(n(this)),tabindex:-1};u.isMultiselect?(t.type="checkbox",t.class="dropdownlist-field"):(t.type="radio",t.class="dropdownlist-field dropdownlist-field-hidden");u.options.isItemSelected(n(this))&&(u.isMultiselect||!f)&&(t.checked="true",f=!0);n(this).prepend(n("<input>",t))});this.isMultiselect||this.getSelectedItems().length!==0||this.setSelectedItems(":first");this.isMultiselect&&this.selectAllItem.length>0&&this.selectAllItem.prepend(n("<input>",{type:"checkbox","class":"dropdownlist-field",checked:this.areAllItemsSelected(),tabindex:-1}));this.container.append(this.selector);this.container.append(this.list);this.setSelectorText();this.container.focusout(this,i.containerFocusout);this.container.keydown(this,i.containerKeydown);this.selector.click(this,i.selectorClick);this.list.click(this,i.listClick);this.allItems.find("input.dropdownlist-field").change(this,i.inputChange);this.textSearch.keyup(this,i.textSearchKeyup);n(document).click(this,i.documentClick);this.allItems.mouseover(this,i.allItemsMouseover);this.allItems.mouseout(this,i.allItemsMouseout)}n.fn.dropdownlist=function(i,r){return n.isFunction(i)&&(r=i,i=null),n(this).each(function(){let u;if(n(this).closest(".dropdownlist").length===0){let r=n.extend({},n.fn.dropdownlist.defaults,i);u=new t(n(this),r);n(this).data("dropdownlist",u)}else u=n(this).data("dropdownlist");n.isFunction(r)&&r.bind(u)(u)})};n.fn.dropdownlist.defaults={getItems:function(t){return n(t).children()},getSelectAllItem:function(t){return n(t).children().filter("[data-select-all]").first()},isItemSelected:function(t){return n(t).data("selected")!==undefined&&n(t).data("selected")!=!1},getFieldName:function(t){return n(t).data("field-name")},getItemValue:function(t){return n(t).data("value")||n(t).text()},getItemText:function(t){return n(t).text()},getEmptyText:function(){return"(Select...)"},isMultiselect:function(t){return n(t).data("multiselect")!==undefined&&n(t).data("multiselect")!=!1},hasTextSearch:function(t){return n(t).data("text-search")!==undefined&&n(t).data("text-search")!=!1},itemMatchesTextSearch:function(t,i){return n(t).text().toLocaleLowerCase().indexOf(i.toLocaleLowerCase())>-1}};t.prototype.isVisible=function(){return this.list.css("display")!=="none"};t.prototype.toggle=function(){this.isVisible()?this.hide():this.show()};t.prototype.hide=function(){this.isVisible()&&(this.list.hide(),this.allItems.removeClass("dropdownlist-list-item-active"),this.textSearch.length>0&&(this.textSearch.filter(document.activeElement).length>0&&this.selector.focus(),this.isMultiselect?this.textSearch.val(""):(this.selectorText.show(),this.textSearch.hide(),this.textSearch.val(this.selectorText.text())),this.items.show()))};t.prototype.show=function(){this.list.show();this.textSearch.length>0&&(this.isMultiselect||(this.selectorText.hide(),this.textSearch.show().select()),this.textSearch.focus())};t.prototype.remove=function(){this.container.before(this.element);this.container.remove();this.items.find("input.dropdownlist-field").remove();this.items.removeClass("dropdownlist-list-item-active");this.selectAllItem.find("input.dropdownlist-field").remove();this.selectAllItem.removeClass("dropdownlist-list-item-active");this.element.removeData("dropdownlist")};t.prototype.setSelectorText=function(){let i=this.getSelectedItems(),t=this.emptyText;i.length>0&&(t=n.map(i,this.options.getItemText).join(", "));this.selectorText.text(t);!this.isMultiselect&&this.textSearch.length>0&&this.textSearch.val(t)};t.prototype.getSelectedItems=function(){return this.items.has("input.dropdownlist-field:checked")};t.prototype.getSelectedValues=function(){return n.map(this.getSelectedItems(),this.options.getItemValue)};t.prototype.setSelectedItems=function(n){let t=this.items.filter(n);this.options.isMultiselect(this.element)||(t=t.first(),t.length===0&&(t=this.items.first()));this.items.not(t).find("input.dropdownlist-field:checked").prop("checked",!1);t.find("input.dropdownlist-field:not(:checked)").prop("checked",!0);this.setSelectorText()};t.prototype.selectAllItems=function(){this.setSelectedItems("*")};t.prototype.clearSelectedItems=function(){this.setSelectedItems(!1)};t.prototype.areAllItemsSelected=function(){return this.items.has("input.dropdownlist-field:not(:checked)").length===0};let i={selectorClick:function(t){n(t.target).is(t.data.textSearch)||t.data.toggle()},inputChange:function(t){t.data.isMultiselect&&t.data.selectAllItem.length>0&&(n(t.target).closest(t.data.selectAllItem).length>0?t.data.selectAllItem.find("input.dropdownlist-field").prop("checked")?t.data.selectAllItems():t.data.clearSelectedItems():t.data.selectAllItem.find("input.dropdownlist-field").prop("checked",t.data.areAllItemsSelected()));t.data.setSelectorText();t.data.element.trigger("dropdownlist.selectedItemsChanged")},listClick:function(t){let i=n(t.target).closest(t.data.allItems);if(i.length!==0){let r=i.find("input.dropdownlist-field");r.is(t.target)?t.data.isMultiselect||t.data.hide():r.click()}},textSearchKeyup:function(n){if(n.which!==r.ENTER&&n.which!==r.ESCAPE&&n.which!==r.ARROW_UP&&n.which!==r.ARROW_DOWN){let i=n.data.textSearch.val(),t=n.data.items;i&&(t=t.filter(function(){return n.data.options.itemMatchesTextSearch(this,i)}));n.data.items.not(t).hide();t.show()}},documentClick:function(t){n(t.target).closest(t.data.container).length>0||t.data.hide()},allItemsMouseover:function(){n(this).addClass("dropdownlist-list-item-active")},allItemsMouseout:function(n){n.data.allItems.removeClass("dropdownlist-list-item-active")},containerFocusout:function(t){t.relatedTarget==null||n(t.relatedTarget).closest(t.data.container).length>0||t.data.hide()},containerKeydown:function(t){if(t.which===r.ENTER){let i=t.data.allItems.filter(".dropdownlist-list-item-active");i.length>0?i.click():n(t.target).closest(t.data.selector).length>0&&t.data.toggle();t.preventDefault()}else if(t.which===r.ARROW_UP){let i=t.data.allItems.filter(":visible"),r=i.index(t.data.allItems.filter(".dropdownlist-list-item-active"));--r>=0&&(t.data.allItems.removeClass("dropdownlist-list-item-active"),n(i[r]).addClass("dropdownlist-list-item-active"));t.preventDefault()}else if(t.which===r.ARROW_DOWN){if(t.data.isVisible()){let i=t.data.allItems.filter(":visible"),r=i.index(t.data.allItems.filter(".dropdownlist-list-item-active"));++r<i.length&&(t.data.allItems.removeClass("dropdownlist-list-item-active"),n(i[r]).addClass("dropdownlist-list-item-active"))}else t.data.show(),t.data.allItems.first().addClass("dropdownlist-list-item-active");t.preventDefault()}else t.which===r.ESCAPE&&t.data.hide()}},r={ENTER:13,ESCAPE:27,ARROW_UP:38,ARROW_DOWN:40}})(jQuery);