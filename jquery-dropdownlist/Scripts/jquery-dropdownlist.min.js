(function(n){function t(t,r){let u=this,f=!1;this.element=t;this.options=r;this.fieldName=this.options.getFieldName(this.element)||"dropdownlist-"+Math.random().toString().replace(".","");this.isMultiselect=this.options.isMultiselect(this.element);this.selectAllItem=this.isMultiselect?this.options.getSelectAllItem(this.element):n();this.allItems=this.options.getItems(this.element).add(this.selectAllItem);this.items=this.options.getItems(this.element).not(this.selectAllItem);this.textSearch=n();this.isTextSearchInsideSelector=!1;this.emptyText=this.options.getEmptyText();this.container=this.createElement("<div>","dropdownlist",this.options.getContainerAttributes());this.element.before(this.container);this.selector=this.createElement("<div>","dropdownlist-selector",this.options.getSelectorAttributes(),{tabindex:0});this.selectorText=this.createElement("<div>","dropdownlist-selector-text",this.options.getSelectorTextAttributes());this.selector.append(this.selectorText,this.createElement("<div>","dropdownlist-selector-toggle",this.options.getSelectorToggleAttributes()));this.list=this.createElement("<div>","dropdownlist-list",this.options.getListAttributes()).append(this.element).hide();this.options.hasTextSearch(this.element)&&(this.textSearch=this.createElement("<input>","dropdownlist-search",this.options.getTextSearchAttributes(),{type:"text"}),this.isTextSearchInsideSelector=this.options.isTextSearchInsideSelector(this.element),this.isTextSearchInsideSelector?(this.selector.prepend(this.textSearch),this.textSearch.hide()):this.list.prepend(this.textSearch));this.items.prepend(this.createElement("<input>","dropdownlist-field",this.options.getInputAttributes(),{name:this.fieldName,value:u.options.getItemValue(n(this)),tabindex:-1,type:u.isMultiselect?"checkbox":"radio"}));this.items.each(function(){let t=n(this).find("input.dropdownlist-field");t.val(u.options.getItemValue(n(this)));u.options.isItemSelected(n(this))&&(u.isMultiselect||!f)&&(t.attr("checked","true"),f=!0)});this.isMultiselect||this.getSelectedItems().length!==0||this.setSelectedItems(":first");this.isMultiselect&&this.selectAllItem.length>0&&this.selectAllItem.prepend(this.createElement("<input>","dropdownlist-field",this.options.getInputAttributes(),{type:"checkbox",checked:this.areAllItemsSelected(),tabindex:-1}));this.container.append(this.selector);this.container.append(this.list);this.setSelectorText();this.container.focusout(this,i.containerFocusout);this.container.keydown(this,i.containerKeydown);this.selector.click(this,i.selectorClick);this.list.click(this,i.listClick);this.element.on("change","input.dropdownlist-field",this,i.inputChange);this.textSearch.keydown(this,i.textSearchKeydown);this.textSearch.keyup(this,i.textSearchKeyup);n(document).click(this,i.documentClick);this.element.on("mouseover","*",this,i.allItemsMouseover);this.element.on("mouseout","*",this,i.allItemsMouseout)}n.fn.dropdownlist=function(i,r){return n.isFunction(i)&&(r=i,i=null),n(this).each(function(){let u=n(this).data("dropdownlist");if(!u){let r=n.extend({},n.fn.dropdownlist.defaults,i);u=new t(n(this),r);n(this).data("dropdownlist",u)}n.isFunction(r)&&r.bind(u)(u)})};n.fn.dropdownlist.defaults={getItems:function(t){return n(t).children()},getSelectAllItem:function(t){return n(t).children().filter("[data-select-all]").first()},isItemSelected:function(t){return n(t).data("selected")!==undefined&&n(t).data("selected")!=!1},getFieldName:function(t){return n(t).data("field-name")},getItemValue:function(t){return n(t).data("value")||n(t).text()},getItemText:function(t){return n(t).text()},getEmptyText:function(){return"(Select...)"},isMultiselect:function(t){return n(t).data("multiselect")!==undefined&&n(t).data("multiselect")!=!1},hasTextSearch:function(t){return n(t).data("text-search")!==undefined&&n(t).data("text-search")!=!1},isTextSearchInsideSelector:function(t){return n(t).data("selector-text-search")!==undefined&&n(t).data("selector-text-search")!=!1},itemMatchesTextSearch:function(t,i){return n(t).text().toLocaleLowerCase().indexOf(i.toLocaleLowerCase())>-1},getContainerAttributes:function(){return{}},getSelectorAttributes:function(){return{}},getSelectorTextAttributes:function(){return{}},getSelectorToggleAttributes:function(){return{}},getListAttributes:function(){return{}},getTextSearchAttributes:function(){return{}},getInputAttributes:function(){return{}}};t.prototype.createElement=function(t,i){let r=n.extend.apply({},Array.prototype.slice.call(arguments,2));return n(t,r).addClass(i)};t.prototype.isVisible=function(){return this.list.css("display")!=="none"};t.prototype.toggle=function(){this.isVisible()?this.hide():this.show()};t.prototype.hide=function(){this.isVisible()&&(this.list.hide(),this.allItems.removeClass("dropdownlist-list-item-active"),this.textSearch.length>0&&(this.textSearch.filter(document.activeElement).length>0&&this.selector.focus(),this.isTextSearchInsideSelector?(this.selectorText.show(),this.textSearch.hide(),this.textSearch.val(this.selectorText.text())):this.textSearch.val(""),this.items.show()))};t.prototype.show=function(){this.list.show();this.textSearch.length>0&&(this.isTextSearchInsideSelector&&(this.selectorText.hide(),this.textSearch.show().select()),this.textSearch.focus());this.isMultiselect||(this.items.has("input.dropdownlist-field:checked").addClass("dropdownlist-list-item-active"),this.scrollToActiveItem())};t.prototype.scrollToActiveItem=function(){let n=this.items.filter(".dropdownlist-list-item-active");n.length>0&&n[0].scrollIntoView&&(n.position().top<0?this.list.scrollTop(this.list.scrollTop()+n.position().top):n.position().top+n.outerHeight(!0)>this.list.height()&&this.list.scrollTop(this.list.scrollTop()-this.list.height()+n.position().top+n.outerHeight(!0)))};t.prototype.remove=function(){this.container.before(this.element);this.container.remove();this.items.find("input.dropdownlist-field").remove();this.items.removeClass("dropdownlist-list-item-active");this.selectAllItem.find("input.dropdownlist-field").remove();this.selectAllItem.removeClass("dropdownlist-list-item-active");this.element.removeData("dropdownlist")};t.prototype.setSelectorText=function(){let i=this.getSelectedItems(),t=this.emptyText;i.length>0&&(t=n.map(i,this.options.getItemText).join(", "));this.selectorText.text(t);this.isTextSearchInsideSelector&&this.textSearch.length>0&&this.textSearch.val(t)};t.prototype.getSelectedItems=function(){return this.items.has("input.dropdownlist-field:checked")};t.prototype.getSelectedValues=function(){return n.map(this.getSelectedItems(),this.options.getItemValue)};t.prototype.setSelectedItems=function(n){let t=this.items.filter(n);this.options.isMultiselect(this.element)||(t=t.first(),t.length===0&&(t=this.items.first()));this.items.not(t).find("input.dropdownlist-field:checked").prop("checked",!1);t.find("input.dropdownlist-field:not(:checked)").prop("checked",!0);this.setSelectorText()};t.prototype.selectAllItems=function(){this.setSelectedItems("*")};t.prototype.clearSelectedItems=function(){this.setSelectedItems(!1)};t.prototype.areAllItemsSelected=function(){return this.items.has("input.dropdownlist-field:not(:checked)").length===0};let i={selectorClick:function(t){n(t.target).is(t.data.textSearch)||t.data.toggle()},inputChange:function(t){t.data.isMultiselect&&t.data.selectAllItem.length>0&&(n(t.target).closest(t.data.selectAllItem).length>0?t.data.selectAllItem.find("input.dropdownlist-field").prop("checked")?t.data.selectAllItems():t.data.clearSelectedItems():t.data.selectAllItem.find("input.dropdownlist-field").prop("checked",t.data.areAllItemsSelected()));t.data.setSelectorText();t.data.element.trigger("dropdownlist.selectedItemsChanged")},listClick:function(t){let i=n(t.target).closest(t.data.allItems);if(i.length!==0){let r=i.find("input.dropdownlist-field");r.is(t.target)?t.data.isMultiselect||t.data.hide():r.click()}},textSearchKeyup:function(n){if(n.which!==r.ENTER&&n.which!==r.ESCAPE&&n.which!==r.ARROW_UP&&n.which!==r.ARROW_DOWN){let i=n.data.textSearch.val(),t=n.data.items;i&&(t=t.filter(function(){return n.data.options.itemMatchesTextSearch(this,i)}));n.data.items.not(t).hide();t.show()}},documentClick:function(t){n(t.target).closest(t.data.container).length>0||t.data.hide()},allItemsMouseover:function(t){t.data.allItems.filter(this).length!==0&&(t.data.allItems.not(this).removeClass("dropdownlist-list-item-active"),n(this).addClass("dropdownlist-list-item-active"))},allItemsMouseout:function(n){n.data.allItems.filter(this).length!==0&&n.data.allItems.removeClass("dropdownlist-list-item-active")},containerFocusout:function(t){t.relatedTarget==null?n(t.target).focus():n(t.relatedTarget).closest(t.data.container).length===0&&t.data.hide()},textSearchKeydown:function(n){n.which===r.SPACE&&n.stopPropagation()},containerKeydown:function(t){if(t.which===r.ENTER||t.which===r.SPACE){let i=t.data.allItems.filter(".dropdownlist-list-item-active");i.length>0?i.click():n(t.target).closest(t.data.selector).length>0&&t.data.toggle();t.preventDefault()}else if(t.which===r.ARROW_UP){let i=t.data.allItems.filter(":visible"),r=i.index(t.data.allItems.filter(".dropdownlist-list-item-active"));--r>=0&&(t.data.allItems.removeClass("dropdownlist-list-item-active"),n(i[r]).addClass("dropdownlist-list-item-active"),t.data.scrollToActiveItem());t.preventDefault()}else if(t.which===r.ARROW_DOWN){if(t.data.isVisible()){let i=t.data.allItems.filter(":visible"),r=i.index(t.data.allItems.filter(".dropdownlist-list-item-active"));++r<i.length&&(t.data.allItems.removeClass("dropdownlist-list-item-active"),n(i[r]).addClass("dropdownlist-list-item-active"),t.data.scrollToActiveItem())}else t.data.show(),t.data.isMultiselect&&(t.data.allItems.first().addClass("dropdownlist-list-item-active"),t.data.scrollToActiveItem());t.preventDefault()}else t.which===r.ESCAPE&&(t.data.hide(),t.data.selector.focus())}},r={ENTER:13,ESCAPE:27,SPACE:32,ARROW_UP:38,ARROW_DOWN:40}})(jQuery);