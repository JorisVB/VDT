(function(n){function t(t,i){let r=this,u=!1;this.element=t;this.options=i;this.fieldName=this.options.getFieldName(this.element)||"dropdownlist-"+Math.random().toString().replace(".","");this.container=n("<div>",{"class":"dropdownlist"});this.element.before(this.container);this.selector=n("<div>",{"class":"dropdownlist-selector"}).append(n("<div>",{"class":"dropdownlist-selector-text"}),n("<div>",{"class":"dropdownlist-selector-toggle"}));this.list=n("<div>",{"class":"dropdownlist-list"}).append(this.element).hide();this.options.getItems(this.element).each(function(){let t={name:r.fieldName,value:r.options.getItemValue(n(this))};r.options.isMultiselect(r.element)?(t.type="checkbox",t.class="dropdownlist-field"):(t.type="radio",t.class="dropdownlist-field dropdownlist-field-hidden");r.options.isItemSelected(n(this))&&(r.options.isMultiselect(r.element)||!u)&&(t.checked="true",u=!0);n(this).prepend(n("<input>",t))});this.options.isMultiselect(this.element)||this.getSelectedItems().length!==0||this.setSelectedItems(":first");this.container.append(this.selector);this.container.append(this.list);this.setSelectorText();this.selector.click(this,this.selectorClick);this.list.click(this,this.listClick);n(document).click(this,this.documentClick)}n.fn.dropdownlist=function(i,r){return n.isFunction(i)&&(r=i,i=null),n(this).each(function(){let u;if(n(this).closest(".dropdownlist").length===0){let r=n.extend({},n.fn.dropdownlist.defaults,i);u=new t(n(this),r);n(this).data("dropdownlist",u)}else u=n(this).data("dropdownlist");n.isFunction(r)&&r.bind(u)(u)})};n.fn.dropdownlist.defaults={getItems:function(t){return n(t).children()},getSelectAllItem:function(t){return n(t).children().filter("[data-select-all]").first()},isItemSelected:function(t){return n(t).data("selected")!==undefined&&n(t).data("selected")!=!1},getFieldName:function(t){return n(t).data("field-name")},getItemValue:function(t){return n(t).data("value")||n(t).text()},getItemText:function(t){return n(t).text()},getEmptyText:function(){return"(Select...)"},isMultiselect:function(t){return n(t).data("multiselect")!==undefined&&n(t).data("multiselect")!=!1}};t.prototype.selectorClick=function(n){n.data.list.toggle()};t.prototype.listClick=function(t){let i=n(t.target).closest(".dropdownlist-list > * > *");if(i.length!==0){let r=i.find("input.dropdownlist-field");if(r.is(t.target)){let i=t.data.options.getSelectAllItem(t.data.element),r=t.data.options.isMultiselect(t.data.element);r&&i.length>0&&(n(t.target).closest(i).length>0?i.find("input.dropdownlist-field").prop("checked")?t.data.selectAllItems():t.data.clearSelectedItems():i.find("input.dropdownlist-field").prop("checked",t.data.areAllItemsSelected()));t.data.setSelectorText();r||t.data.list.hide();t.data.element.trigger("dropdownlist.selectedItemsChanged")}else r.click()}};t.prototype.documentClick=function(t){n(t.target).closest(".dropdownlist").is(t.data.container)||t.data.list.hide()};t.prototype.remove=function(){this.container.before(this.element);this.container.remove();this.options.getItems(this.element).find("input.dropdownlist-field").remove();this.element.removeData("dropdownlist")};t.prototype.setSelectorText=function(){let t=this.getSelectedItems(),i=this.options.getEmptyText();t.length>0&&(i=n.map(t,this.options.getItemText).join(", "));this.container.find(".dropdownlist-selector-text").text(i)};t.prototype.getSelectedItems=function(){return this.options.getItems(this.element).has("input.dropdownlist-field:checked").not(this.options.getSelectAllItem(this.element))};t.prototype.getSelectedValues=function(){return n.map(this.getSelectedItems(),this.options.getItemValue)};t.prototype.setSelectedItems=function(n){let i=this.options.getItems(this.element),t=i.filter(n);this.options.isMultiselect(this.element)||(t=t.first(),t.length===0&&(t=i.first()));i.not(t).find("input.dropdownlist-field:checked").prop("checked",!1);t.find("input.dropdownlist-field:not(:checked)").prop("checked",!0);this.setSelectorText()};t.prototype.selectAllItems=function(){this.setSelectedItems("*")};t.prototype.clearSelectedItems=function(){this.setSelectedItems(!1)};t.prototype.areAllItemsSelected=function(){return this.options.getItems(this.element).has("input.dropdownlist-field:not(:checked)").not(this.options.getSelectAllItem(this.element)).length===0}})(jQuery);